<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå - ‡∏™‡∏û‡∏ê.‡∏ï‡∏£.</title>
    <style>
        :root {
            --bg-gradient-start: #e8f4fc;
            --bg-gradient-end: #ffffff;
            --card-bg: #ffffff;
            --text-primary: #1e3a5f;
            --text-secondary: #5a7a9a;
            --border-color: #d0e3f0;
            --hover-bg: #f0f7fc;
            --accent-color: #2196F3;
        }

        [data-theme="dark"] {
            --bg-gradient-start: #0d1b2a;
            --bg-gradient-end: #1b2838;
            --card-bg: #1e3a5f;
            --text-primary: #e8f4fc;
            --text-secondary: #a8c5db;
            --border-color: #2d4a6a;
            --hover-bg: #2d4a6a;
            --accent-color: #64b5f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Sarabun', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container { max-width: 1600px; margin: 0 auto; }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: var(--card-bg);
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle span { font-size: 24px; }
        .theme-toggle-text { color: var(--text-primary); font-weight: bold; }

        .header {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            background: linear-gradient(135deg, var(--accent-color), #1976D2);
        }

        .header-text h1 { color: var(--text-primary); font-size: 28px; }
        .header-text p { color: var(--text-secondary); font-size: 16px; }

        .header-buttons { margin-left: auto; display: flex; gap: 10px; }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary { background: linear-gradient(135deg, var(--accent-color), #1976D2); color: white; }
        .btn-secondary { background: var(--hover-bg); color: var(--text-primary); border: 2px solid var(--border-color); }
        .btn-success { background: linear-gradient(135deg, #4caf50, #388e3c); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }

        /* Export button - hidden until permission system is ready */
        .hidden-feature { display: none; }

        .search-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .search-section h2 { color: var(--text-primary); margin-bottom: 20px; font-size: 24px; }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group label { display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold; }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        }

        .search-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }

        .results-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-header h2 { color: var(--text-primary); }
        .results-count { color: var(--text-secondary); font-size: 18px; }

        .table-container { overflow-x: auto; }

        .results-table { width: 100%; border-collapse: collapse; margin-top: 20px; min-width: 800px; }

        .results-table th, .results-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .results-table th {
            background: linear-gradient(135deg, var(--accent-color), #1976D2);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .results-table tr:hover { background: var(--hover-bg); }
        .results-table td { color: var(--text-primary); }

        .status-badge { padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; white-space: nowrap; }
        .status-available { background: #4caf50; color: white; }
        .status-damaged { background: #f44336; color: white; }
        .status-pending { background: #ff9800; color: white; }

        .category-icon { display: inline-flex; align-items: center; gap: 8px; }

        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 30px; flex-wrap: wrap; }

        .pagination button {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover, .pagination button.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }

        .no-results { text-align: center; padding: 50px; color: var(--text-secondary); }
        .no-results span { font-size: 60px; display: block; margin-bottom: 20px; }

        .loading { text-align: center; padding: 50px; color: var(--text-secondary); }
        .loading::after {
            content: '';
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
            vertical-align: middle;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .header-buttons { margin-left: 0; }
            .theme-toggle { top: auto; bottom: 20px; }
        }
    </style>
<script src="/config.js"></script></head>
<body data-theme="dark">

    <div class="theme-toggle" onclick="toggleTheme()">
        <span id="themeIcon">‚òÄÔ∏è</span>
        <span class="theme-toggle-text" id="themeText">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á</span>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-logo">üì¶</div>
            <div class="header-text">
                <h1>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h1>
                <p>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ï‡∏≥‡∏£‡∏ß‡∏à (‡∏™‡∏û‡∏ê.‡∏ï‡∏£.)</p>
            </div>
            <div class="header-buttons">
                <a href="equipment.html" class="btn btn-primary">üìä Dashboard</a>
                <a href="index.html" class="btn btn-secondary">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            </div>
        </div>

        <div class="search-section">
            <h2>üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h2>
            <div class="search-form">
                <div class="form-group">
                    <label>üî§ ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</label>
                    <input type="text" id="searchText" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå, ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå...">
                </div>
                <div class="form-group">
                    <label>üìÅ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="categoryFilter"><option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select>
                </div>
                <div class="form-group">
                    <label>üèõÔ∏è ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                    <select id="unitFilter"><option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select>
                </div>
                <div class="form-group">
                    <label>üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                    <select id="statusFilter">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</option>
                        <option value="‡∏ä‡∏≥‡∏£‡∏∏‡∏î">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</option>
                        <option value="‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢">‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üìÖ ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)</label>
                    <select id="yearStart"><option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option></select>
                </div>
                <div class="form-group">
                    <label>üìÖ ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö (‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)</label>
                    <select id="yearEnd"><option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option></select>
                </div>
            </div>
            <div class="search-buttons">
                <button class="btn btn-primary" onclick="searchEquipment()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                <button class="btn btn-secondary" onclick="clearSearch()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                <button class="btn btn-success hidden-feature" onclick="exportToExcel()">üì• Export Excel</button>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">
                <h2>üìã ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
                <span class="results-count" id="resultsCount">‡∏û‡∏ö 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            <div class="table-container">
                <div id="resultsContent">
                    <div class="no-results">
                        <span>üîç</span>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                </div>
            </div>
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        const typeIcons = {
            '‡πÇ‡∏ï‡πä‡∏∞': 'ü™ë', '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ': 'üí∫', '‡∏ï‡∏π‡πâ': 'üóÑÔ∏è',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': 'üíª', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': 'üíª',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå': 'üñ®Ô∏è', 'Printer': 'üñ®Ô∏è',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®': '‚ùÑÔ∏è', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ü': 'üîã',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®': 'üå¨Ô∏è', '‡πÇ‡∏ó‡∏£‡∏ó‡∏±‡∏®‡∏ô‡πå': 'üì∫',
            '‡∏Å‡∏•‡πâ‡∏≠‡∏á': 'üì∑', '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå': 'üìû', '‡∏û‡∏±‡∏î‡∏•‡∏°': 'üåÄ',
            '‡∏à‡∏≠‡∏†‡∏≤‡∏û': 'üñ•Ô∏è', 'Note': 'üíª', '‡∏ê‡∏≤‡∏ô‡∏ß‡∏≤‡∏á‡πÄ‡∏Ñ‡∏™': 'üñ•Ô∏è',
            '‡∏ä‡∏±‡πâ‡∏ô': 'üìö', '‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤': '‚è±Ô∏è', '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå': 'üîß',
            '‡∏£‡∏ñ': 'üöó', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á': '‚öôÔ∏è'
        };

        function getTypeIcon(type) {
            if (!type) return 'üì¶';
            for (const key in typeIcons) {
                if (type.includes(key)) return typeIcons[key];
            }
            return 'üì¶';
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeIcon').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
            document.getElementById('themeText').textContent = isDark ? '‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î' : '‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        document.getElementById('themeText').textContent = savedTheme === 'dark' ? '‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á' : '‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î';

        let currentPage = 1;
        const pageSize = 20;
        let totalResults = 0;
        let allResults = [];

        async function loadFilterOptions() {
            try {
                const response = await fetch(API_BASE_URL + '/api/equipment/stats');
                const result = await response.json();
                if (result.success) {
                    const categorySelect = document.getElementById('categoryFilter');
                    result.data.byCategory.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat.category;
                        option.textContent = `${getTypeIcon(cat.category)} ${cat.category} (${cat.count})`;
                        categorySelect.appendChild(option);
                    });
                    const unitSelect = document.getElementById('unitFilter');
                    result.data.byUnit.forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit.unit;
                        option.textContent = `${unit.unit} (${unit.count})`;
                        unitSelect.appendChild(option);
                    });
                }
                const yearsResponse = await fetch(API_BASE_URL + '/api/equipment/years');
                const yearsResult = await yearsResponse.json();
                if (yearsResult.success) {
                    const yearStartSelect = document.getElementById('yearStart');
                    const yearEndSelect = document.getElementById('yearEnd');
                    yearsResult.data.forEach(year => {
                        yearStartSelect.appendChild(new Option(year, year));
                        yearEndSelect.appendChild(new Option(year, year));
                    });
                }
            } catch (error) {
                console.error('Error loading filter options:', error);
            }
        }

        async function searchEquipment() {
            const searchText = document.getElementById('searchText').value;
            const category = document.getElementById('categoryFilter').value;
            const unit = document.getElementById('unitFilter').value;
            const status = document.getElementById('statusFilter').value;
            const yearStart = document.getElementById('yearStart').value;
            const yearEnd = document.getElementById('yearEnd').value;

            const params = new URLSearchParams();
            if (searchText) params.append('search', searchText);
            if (category) params.append('category', category);
            if (unit) params.append('unit', unit);
            if (status) params.append('status', status);
            if (yearStart) params.append('yearStart', yearStart);
            if (yearEnd) params.append('yearEnd', yearEnd);
            params.append('limit', 1000);

            document.getElementById('resultsContent').innerHTML = '<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</div>';

            try {
                const response = await fetch(`/api/equipment?${params.toString()}`);
                const result = await response.json();
                if (result.success) {
                    allResults = result.data;
                    totalResults = allResults.length;
                    currentPage = 1;
                    displayResults();
                } else {
                    document.getElementById('resultsContent').innerHTML = `<div class="no-results"><span>‚ùå</span><p>${result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'}</p></div>`;
                }
            } catch (error) {
                console.error('Error searching:', error);
                document.getElementById('resultsContent').innerHTML = '<div class="no-results"><span>‚ùå</span><p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p></div>';
            }
        }

        function displayResults() {
            document.getElementById('resultsCount').textContent = `‡∏û‡∏ö ${totalResults.toLocaleString('th-TH')} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            if (totalResults === 0) {
                document.getElementById('resultsContent').innerHTML = '<div class="no-results"><span>üì≠</span><p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p></div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, totalResults);
            const pageResults = allResults.slice(startIndex, endIndex);

            let html = `<table class="results-table"><thead><tr>
                <th>#</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th><th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
                <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th><th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            </tr></thead><tbody>`;

            pageResults.forEach((item, index) => {
                const icon = getTypeIcon(item.category);
                const statusClass = item.status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? 'status-available' : 
                                   item.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î' ? 'status-damaged' : 'status-pending';
                html += `<tr>
                    <td>${startIndex + index + 1}</td>
                    <td><span class="category-icon">${icon} ${item.category || '-'}</span></td>
                    <td>${item.item_name || '-'}</td>
                    <td>${item.equipment_code || '-'}</td>
                    <td>${item.unit || '-'}</td>
                    <td>${item.acquired_year || '-'}</td>
                    <td>${item.quantity || 1}</td>
                    <td><span class="status-badge ${statusClass}">${item.status || '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ'}</span></td>
                </tr>`;
            });

            html += '</tbody></table>';
            document.getElementById('resultsContent').innerHTML = html;

            const totalPages = Math.ceil(totalResults / pageSize);
            let paginationHtml = '';
            if (totalPages > 1) {
                paginationHtml += `<button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`;
                const maxButtons = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
                let endPage = Math.min(totalPages, startPage + maxButtons - 1);
                if (endPage - startPage + 1 < maxButtons) startPage = Math.max(1, endPage - maxButtons + 1);
                if (startPage > 1) {
                    paginationHtml += `<button onclick="goToPage(1)">1</button>`;
                    if (startPage > 2) paginationHtml += `<button disabled>...</button>`;
                }
                for (let i = startPage; i <= endPage; i++) {
                    paginationHtml += `<button onclick="goToPage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
                }
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) paginationHtml += `<button disabled>...</button>`;
                    paginationHtml += `<button onclick="goToPage(${totalPages})">${totalPages}</button>`;
                }
                paginationHtml += `<button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>`;
            }
            document.getElementById('pagination').innerHTML = paginationHtml;
        }

        function goToPage(page) {
            const totalPages = Math.ceil(totalResults / pageSize);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            displayResults();
            window.scrollTo({ top: document.querySelector('.results-section').offsetTop - 20, behavior: 'smooth' });
        }

        function clearSearch() {
            document.getElementById('searchText').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('unitFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('yearStart').value = '';
            document.getElementById('yearEnd').value = '';
            document.getElementById('resultsContent').innerHTML = '<div class="no-results"><span>üîç</span><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div>';
            document.getElementById('resultsCount').textContent = '‡∏û‡∏ö 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
            document.getElementById('pagination').innerHTML = '';
            allResults = [];
            totalResults = 0;
        }

        function exportToExcel() {
            if (allResults.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ Export ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            let csv = '\uFEFF';
            csv += '‡∏•‡∏≥‡∏î‡∏±‡∏ö,‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà,‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå,‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå,‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô,‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞\n';
            allResults.forEach((item, index) => {
                csv += `${index + 1},"${(item.category || '').replace(/"/g, '""')}","${(item.item_name || '').replace(/"/g, '""')}","${(item.equipment_code || '').replace(/"/g, '""')}","${(item.unit || '').replace(/"/g, '""')}",${item.acquired_year || ''},${item.quantity || 1},"${(item.status || '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ').replace(/"/g, '""')}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `equipment_export_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();
        }

        document.getElementById('searchText').addEventListener('keypress', e => { if (e.key === 'Enter') searchEquipment(); });

        // Init
        loadFilterOptions();
    </script>
</body>
</html>
