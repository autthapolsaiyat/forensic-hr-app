<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå - ‡∏™‡∏û‡∏ê.‡∏ï‡∏£.</title>
    <style>
        :root {
            --bg-gradient-start: #e8f4fc;
            --bg-gradient-end: #ffffff;
            --card-bg: #ffffff;
            --text-primary: #1e3a5f;
            --text-secondary: #5a7a9a;
            --border-color: #d0e3f0;
            --hover-bg: #f0f7fc;
            --accent-color: #2196F3;
        }

        [data-theme="dark"] {
            --bg-gradient-start: #0d1b2a;
            --bg-gradient-end: #1b2838;
            --card-bg: #1e3a5f;
            --text-primary: #e8f4fc;
            --text-secondary: #a8c5db;
            --border-color: #2d4a6a;
            --hover-bg: #2d4a6a;
            --accent-color: #64b5f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Sarabun', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container { max-width: 1600px; margin: 0 auto; }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            flex-shrink: 0;
        }

        .header-content { flex: 1; min-width: 200px; }
        .header h1 { color: var(--text-primary); font-size: 32px; margin-bottom: 5px; }
        .header p { color: var(--text-secondary); font-size: 18px; }

        .header-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        .nav-btn.search-btn { background: linear-gradient(135deg, #48bb78, #38a169); }

        .theme-btn {
            background: var(--hover-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            border-color: var(--accent-color);
            background: var(--card-bg);
        }

        /* Overview Stats */
        .overview-section {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .overview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 3px solid #2196F3;
        }

        .section-title {
            color: var(--text-primary);
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .year-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .year-filter label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: bold;
        }

        .year-select {
            padding: 10px 15px;
            font-size: 14px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-primary);
            cursor: pointer;
            min-width: 100px;
        }

        .year-select:focus { outline: none; border-color: #2196F3; }

        .filter-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }

        .filter-btn:hover { transform: translateY(-2px); }
        .filter-btn.primary { background: linear-gradient(135deg, #2196F3, #1976D2); color: white; }
        .filter-btn.secondary { background: var(--hover-bg); color: var(--text-primary); border: 2px solid var(--border-color); }

        .year-info {
            text-align: center;
            padding: 12px;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(25, 118, 210, 0.1));
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 15px;
            margin-bottom: 25px;
        }

        .year-info strong { color: #2196F3; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
        }

        .stat-card {
            text-align: center;
            padding: 30px 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            color: white;
        }

        .stat-card.total { background: linear-gradient(135deg, #2196F3, #1976D2); }
        .stat-card.available { background: linear-gradient(135deg, #48bb78, #38a169); }
        .stat-card.damaged { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .stat-card.pending { background: linear-gradient(135deg, #ed8936, #dd6b20); }
        .stat-card.disposed { background: linear-gradient(135deg, #718096, #4a5568); }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .stat-label { font-size: 18px; margin-bottom: 15px; opacity: 0.95; }
        .stat-number { font-size: 56px; font-weight: bold; margin-bottom: 10px; }
        .stat-unit { font-size: 20px; opacity: 0.9; }
        .stat-percent { font-size: 16px; opacity: 0.85; margin-top: 5px; }

        /* Types Section */
        .types-section, .units-section {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .section-title-full {
            color: var(--text-primary);
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #2196F3;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .types-grid, .units-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .type-card {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .type-card {
            background: linear-gradient(135deg, #374151, #4a5568);
        }

        .type-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(33, 150, 243, 0.3);
            border-color: #2196F3;
        }

        .type-icon { font-size: 48px; text-align: center; margin-bottom: 15px; }
        .type-name { font-size: 18px; font-weight: bold; color: var(--text-primary); text-align: center; margin-bottom: 15px; }
        .type-count { font-size: 48px; font-weight: bold; color: #2196F3; text-align: center; margin: 20px 0; }
        .type-hint { text-align: center; font-size: 12px; color: var(--text-secondary); opacity: 0.7; margin-top: 10px; }

        .dept-card {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .dept-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(33, 150, 243, 0.4);
        }

        .dept-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .dept-icon { font-size: 32px; }
        .dept-name { font-size: 18px; font-weight: bold; }
        .dept-total { font-size: 48px; font-weight: bold; text-align: center; margin: 15px 0; }
        .dept-total-label { text-align: center; font-size: 14px; opacity: 0.9; }

        .dept-breakdown {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
        }

        .dept-stat-item { text-align: center; }
        .dept-stat-icon { font-size: 20px; margin-bottom: 5px; }
        .dept-stat-value { font-size: 24px; font-weight: bold; }
        .dept-stat-label { font-size: 12px; opacity: 0.8; margin-top: 3px; }

        /* Charts */
        .charts-header {
            background: var(--card-bg);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .charts-header h2 {
            color: var(--text-primary);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-charts-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .toggle-charts-btn:hover { transform: translateY(-2px); }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .charts-section.hidden { display: none; }

        .chart-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chart-title {
            color: var(--text-primary);
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        canvas { max-height: 300px; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 95%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            position: relative;
        }

        .modal-header h2 { font-size: 28px; margin-bottom: 10px; }

        .close {
            position: absolute;
            right: 25px;
            top: 25px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover { transform: rotate(90deg); }

        .modal-body { padding: 30px; }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border-radius: 12px;
            padding: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(33, 150, 243, 0.4);
        }

        .summary-card-icon { font-size: 40px; margin-bottom: 10px; }
        .summary-card-label { font-size: 16px; margin-bottom: 10px; opacity: 0.9; }
        .summary-card-count { font-size: 42px; font-weight: bold; margin-bottom: 10px; }
        .summary-card-status { display: flex; justify-content: center; gap: 15px; font-size: 14px; opacity: 0.9; }

        .status-summary { margin-top: 30px; padding-top: 30px; border-top: 2px solid var(--border-color); }
        .status-summary-title { color: var(--text-primary); font-size: 22px; font-weight: bold; margin-bottom: 20px; text-align: center; }

        .status-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-summary-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .status-summary-card.available { background: linear-gradient(135deg, #48bb78, #38a169); }
        .status-summary-card.damaged { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .status-summary-card.pending { background: linear-gradient(135deg, #ed8936, #dd6b20); }

        .status-summary-card:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }

        .status-summary-card-icon { font-size: 32px; margin-bottom: 10px; }
        .status-summary-card-count { font-size: 48px; font-weight: bold; margin-bottom: 5px; }
        .status-summary-card-label { font-size: 16px; opacity: 0.9; }

        .click-hint { text-align: center; color: var(--text-secondary); font-size: 14px; font-style: italic; margin-top: 15px; }

        .equipment-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .equipment-table th { background: linear-gradient(135deg, #2196F3, #1976D2); color: white; padding: 15px; text-align: left; }
        .equipment-table td { padding: 15px; border-bottom: 1px solid var(--border-color); color: var(--text-primary); }
        .equipment-table tr:hover { background-color: var(--hover-bg); }

        .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .badge-available { background-color: #c6f6d5; color: #22543d; }
        .badge-damaged { background-color: #fed7d7; color: #742a2a; }
        .badge-pending { background-color: #feebc8; color: #7c2d12; }

        .loading { text-align: center; padding: 40px; color: var(--text-secondary); font-size: 18px; }

        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .header-nav { justify-content: center; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .types-grid, .units-grid { grid-template-columns: 1fr; }
            .charts-section { grid-template-columns: 1fr; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header with Theme Toggle -->
        <div class="header">
            <div class="header-logo">üì¶</div>
            <div class="header-content">
                <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h1>
                <p>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ï‡∏≥‡∏£‡∏ß‡∏à (‡∏™‡∏û‡∏ê.‡∏ï‡∏£.)</p>
            </div>
            <div class="header-nav">
                <a href="/equipment-search.html" class="nav-btn search-btn">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</a>
                <a href="/" class="nav-btn">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <button class="theme-btn" onclick="toggleTheme()">
                    <span id="themeIcon">üåô</span>
                    <span id="themeText">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</span>
                </button>
            </div>
        </div>

        <!-- Overview Statistics -->
        <div class="overview-section">
            <div class="overview-header">
                <h2 class="section-title">üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div class="year-filter">
                    <label>‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</label>
                    <select id="yearStart" class="year-select"><option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option></select>
                    <span style="color: var(--text-secondary);">‡∏ñ‡∏∂‡∏á</span>
                    <select id="yearEnd" class="year-select"><option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option></select>
                    <button class="filter-btn primary" onclick="applyYearFilter()">üîç ‡∏Å‡∏£‡∏≠‡∏á</button>
                    <button class="filter-btn secondary" onclick="resetYearFilter()">üîÑ ‡∏•‡πâ‡∏≤‡∏á</button>
                </div>
            </div>
            <div class="year-info" id="yearInfo">üìÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</strong></div>
            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="stat-number" id="totalEquipment">-</div>
                    <div class="stat-unit">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                </div>
                <div class="stat-card available">
                    <div class="stat-label">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div>
                    <div class="stat-number" id="availableEquipment">-</div>
                    <div class="stat-unit">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    <div class="stat-percent" id="availablePercent">-</div>
                </div>
                <div class="stat-card damaged">
                    <div class="stat-label">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</div>
                    <div class="stat-number" id="damagedEquipment">-</div>
                    <div class="stat-unit">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    <div class="stat-percent" id="damagedPercent">-</div>
                </div>
                <div class="stat-card pending">
                    <div class="stat-label">‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</div>
                    <div class="stat-number" id="pendingEquipment">-</div>
                    <div class="stat-unit">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    <div class="stat-percent" id="pendingPercent">-</div>
                </div>
                <div class="stat-card disposed">
                    <div class="stat-label">‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</div>
                    <div class="stat-number" id="disposedEquipment">-</div>
                    <div class="stat-unit">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    <div class="stat-percent" id="disposedPercent">-</div>
                </div>
            </div>
        </div>

        <!-- Types Grid -->
        <div class="types-section">
            <h2 class="section-title-full">üì¶ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
            <div id="typesGrid" class="types-grid"><div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <!-- Units Grid -->
        <div class="units-section">
            <h2 class="section-title-full">üèõÔ∏è ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢</h2>
            <div id="unitsGrid" class="units-grid"><div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
        </div>

        <!-- Charts -->
        <div class="charts-header">
            <h2>üìä ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
            <button class="toggle-charts-btn" onclick="toggleCharts()">
                <span id="chartsToggleIcon">üëÅÔ∏è</span>
                <span id="chartsToggleText">‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü</span>
            </button>
        </div>

        <div class="charts-section" id="chartsSection">
            <div class="chart-card">
                <h3 class="chart-title">üìä ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">üìà Top 5 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î</h3>
                <canvas id="unitChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Summary Modal -->
    <div id="summaryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeSummaryModal()">&times;</span>
                <h2 id="summaryModalTitle">-</h2>
                <p id="summaryModalSubtitle">-</p>
            </div>
            <div class="modal-body">
                <div id="summaryContent"><div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeDetailModal()">&times;</span>
                <h2 id="detailModalTitle">-</h2>
                <p id="detailModalSubtitle">-</p>
            </div>
            <div class="modal-body">
                <div id="detailContent"><div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>
            </div>
        </div>
    </div>

    <script>
        let statsData = null;
        let currentDepartment = null;
        let currentDepartmentEquipment = [];
        let currentYearStart = '';
        let currentYearEnd = '';
        let statusChart = null;
        let unitChart = null;

        // Type icons
        const typeIcons = {
            '‡πÇ‡∏ï‡πä‡∏∞': 'ü™ë', '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ': 'üí∫', '‡∏ï‡∏π‡πâ': 'üóÑÔ∏è',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': 'üíª', '‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå': 'üíª',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå': 'üñ®Ô∏è', 'Printer': 'üñ®Ô∏è',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®': '‚ùÑÔ∏è', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ü': 'üîã',
            '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®': 'üå¨Ô∏è', '‡πÇ‡∏ó‡∏£‡∏ó‡∏±‡∏®‡∏ô‡πå': 'üì∫',
            '‡∏Å‡∏•‡πâ‡∏≠‡∏á': 'üì∑', '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå': 'üìû', '‡∏û‡∏±‡∏î‡∏•‡∏°': 'üåÄ',
            '‡∏à‡∏≠‡∏†‡∏≤‡∏û': 'üñ•Ô∏è', 'Note': 'üíª', '‡∏ê‡∏≤‡∏ô‡∏ß‡∏≤‡∏á‡πÄ‡∏Ñ‡∏™': 'üñ•Ô∏è',
            '‡∏ä‡∏±‡πâ‡∏ô': 'üìö', '‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤': '‚è±Ô∏è', '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå': 'üîß',
            '‡∏£‡∏ñ': 'üöó', '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á': '‚öôÔ∏è'
        };

        function getTypeIcon(type) {
            if (!type) return 'üì¶';
            for (const key in typeIcons) {
                if (type.includes(key)) return typeIcons[key];
            }
            return 'üì¶';
        }

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            document.getElementById('themeIcon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            document.getElementById('themeText').textContent = newTheme === 'dark' ? '‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á' : '‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î';
        }

        // Toggle charts
        function toggleCharts() {
            const section = document.getElementById('chartsSection');
            const isHidden = section.classList.toggle('hidden');
            document.getElementById('chartsToggleIcon').textContent = isHidden ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è';
            document.getElementById('chartsToggleText').textContent = isHidden ? '‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü' : '‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü';
            localStorage.setItem('chartsVisible', !isHidden);
        }

        // Init
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            document.getElementById('themeText').textContent = savedTheme === 'dark' ? '‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á' : '‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î';

            if (localStorage.getItem('chartsVisible') === 'false') {
                document.getElementById('chartsSection').classList.add('hidden');
                document.getElementById('chartsToggleIcon').textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
                document.getElementById('chartsToggleText').textContent = '‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü';
            }

            loadAvailableYears();
            loadAllData();
        });

        // Load years
        async function loadAvailableYears() {
            try {
                const response = await fetch('/api/equipment/years');
                const result = await response.json();
                if (result.success) {
                    const yearStart = document.getElementById('yearStart');
                    const yearEnd = document.getElementById('yearEnd');
                    result.data.forEach(year => {
                        yearStart.innerHTML += `<option value="${year}">${year}</option>`;
                        yearEnd.innerHTML += `<option value="${year}">${year}</option>`;
                    });
                }
            } catch (error) {
                console.error('Error loading years:', error);
            }
        }

        // Apply filter
        async function applyYearFilter() {
            currentYearStart = document.getElementById('yearStart').value;
            currentYearEnd = document.getElementById('yearEnd').value;
            if (currentYearStart && currentYearEnd && parseInt(currentYearStart) > parseInt(currentYearEnd)) {
                alert('‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏µ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }
            await loadAllData();
        }

        // Reset filter
        async function resetYearFilter() {
            document.getElementById('yearStart').value = '';
            document.getElementById('yearEnd').value = '';
            currentYearStart = '';
            currentYearEnd = '';
            await loadAllData();
        }

        // Load data
        async function loadAllData() {
            try {
                let params = new URLSearchParams();
                if (currentYearStart) params.append('yearStart', currentYearStart);
                if (currentYearEnd) params.append('yearEnd', currentYearEnd);
                
                const url = `/api/equipment/stats${params.toString() ? '?' + params.toString() : ''}`;
                const response = await fetch(url);
                const result = await response.json();

                if (result.success) {
                    statsData = result.data;
                    updateYearInfo();
                    displayOverviewStats(statsData);
                    displayTypesGrid(statsData);
                    displayUnitsGrid(statsData);
                    createCharts(statsData);
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Update year info
        function updateYearInfo() {
            const yearInfo = document.getElementById('yearInfo');
            if (currentYearStart && currentYearEnd) {
                yearInfo.innerHTML = `üìÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>‡∏õ‡∏µ ${currentYearStart} - ${currentYearEnd}</strong>`;
            } else if (currentYearStart) {
                yearInfo.innerHTML = `üìÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>‡∏õ‡∏µ ${currentYearStart} ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ</strong>`;
            } else if (currentYearEnd) {
                yearInfo.innerHTML = `üìÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>‡∏ñ‡∏∂‡∏á‡∏õ‡∏µ ${currentYearEnd}</strong>`;
            } else {
                yearInfo.innerHTML = `üìÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</strong>`;
            }
        }

        // Display stats - FIXED to use direct fields from API
        function displayOverviewStats(data) {
            const total = data.totalItems || 0;
            const available = data.available || 0;
            const damaged = data.damaged || 0;
            const pending = data.pending || 0;
            const disposed = data.disposed || 0;

            document.getElementById('totalEquipment').textContent = total.toLocaleString('th-TH');
            document.getElementById('availableEquipment').textContent = available.toLocaleString('th-TH');
            document.getElementById('availablePercent').textContent = total > 0 ? `(${((available/total)*100).toFixed(1)}%)` : '-';
            
            document.getElementById('damagedEquipment').textContent = damaged.toLocaleString('th-TH');
            document.getElementById('damagedPercent').textContent = total > 0 ? `(${((damaged/total)*100).toFixed(1)}%)` : '-';
            
            document.getElementById('pendingEquipment').textContent = pending.toLocaleString('th-TH');
            document.getElementById('pendingPercent').textContent = total > 0 ? `(${((pending/total)*100).toFixed(1)}%)` : '-';
            
            document.getElementById('disposedEquipment').textContent = disposed.toLocaleString('th-TH');
            document.getElementById('disposedPercent').textContent = total > 0 ? `(${((disposed/total)*100).toFixed(1)}%)` : '-';
        }

        // Display types
        function displayTypesGrid(data) {
            const grid = document.getElementById('typesGrid');
            grid.innerHTML = '';

            data.byCategory.forEach(cat => {
                const card = document.createElement('div');
                card.className = 'type-card';
                card.onclick = () => showCategoryDetail(cat.category);
                card.innerHTML = `
                    <div class="type-icon">${getTypeIcon(cat.category)}</div>
                    <div class="type-name">${cat.category}</div>
                    <div class="type-count">${parseInt(cat.count).toLocaleString('th-TH')}</div>
                    <div class="type-hint">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
                `;
                grid.appendChild(card);
            });
        }

        // Display units
        function displayUnitsGrid(data) {
            const grid = document.getElementById('unitsGrid');
            grid.innerHTML = '';

            data.byUnit.forEach((dept, index) => {
                const card = document.createElement('div');
                card.className = 'dept-card';
                card.onclick = () => showDepartmentSummary(dept.unit);
                card.innerHTML = `
                    <div class="dept-header">
                        <div class="dept-icon">üèõÔ∏è</div>
                        <div class="dept-name">${dept.unit}</div>
                    </div>
                    <div class="dept-total-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="dept-total">${parseInt(dept.count).toLocaleString('th-TH')}</div>
                    <div class="dept-breakdown">
                        <div class="dept-stat-item">
                            <div class="dept-stat-icon">‚úì</div>
                            <div class="dept-stat-value" id="dept-available-${index}">-</div>
                            <div class="dept-stat-label">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div>
                        </div>
                        <div class="dept-stat-item">
                            <div class="dept-stat-icon">‚úó</div>
                            <div class="dept-stat-value" id="dept-damaged-${index}">-</div>
                            <div class="dept-stat-label">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</div>
                        </div>
                        <div class="dept-stat-item">
                            <div class="dept-stat-icon">‚è≥</div>
                            <div class="dept-stat-value" id="dept-pending-${index}">-</div>
                            <div class="dept-stat-label">‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
                loadDeptStats(dept.unit, index);
            });
        }

        // Load dept stats
        async function loadDeptStats(unit, index) {
            try {
                const response = await fetch(`/api/equipment?unit=${encodeURIComponent(unit)}&limit=1000`);
                const result = await response.json();
                if (result.success) {
                    let available = 0, damaged = 0, pending = 0;
                    result.data.forEach(v => {
                        if (v.status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || !v.status) available++;
                        else if (v.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î') damaged++;
                        else if (v.status === '‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢') pending++;
                    });
                    document.getElementById(`dept-available-${index}`).textContent = available;
                    document.getElementById(`dept-damaged-${index}`).textContent = damaged;
                    document.getElementById(`dept-pending-${index}`).textContent = pending;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Create charts - FIXED
        function createCharts(data) {
            // Destroy existing charts
            if (statusChart) statusChart.destroy();
            if (unitChart) unitChart.destroy();

            const total = data.totalItems || 0;
            const available = data.available || 0;
            const damaged = data.damaged || 0;
            const pending = data.pending || 0;
            const disposed = data.disposed || 0;

            // Status Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            statusChart = new Chart(statusCtx, {
                type: 'bar',
                data: {
                    labels: [
                        `‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (${available})`,
                        `‡∏ä‡∏≥‡∏£‡∏∏‡∏î (${damaged})`,
                        `‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (${pending})`,
                        `‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (${disposed})`
                    ],
                    datasets: [{
                        data: [available, damaged, pending, disposed],
                        backgroundColor: ['#48bb78', '#f56565', '#ed8936', '#718096'],
                        borderRadius: 8,
                        barThickness: 40
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { beginAtZero: true, grid: { display: false } },
                        y: { grid: { display: false } }
                    }
                }
            });

            // Unit Chart
            const unitCtx = document.getElementById('unitChart').getContext('2d');
            const top5 = data.byUnit.slice(0, 5);
            unitChart = new Chart(unitCtx, {
                type: 'bar',
                data: {
                    labels: top5.map(d => d.unit),
                    datasets: [{
                        data: top5.map(d => parseInt(d.count)),
                        backgroundColor: ['rgba(33, 150, 243, 0.9)', 'rgba(25, 118, 210, 0.9)', 'rgba(21, 101, 192, 0.9)', 'rgba(13, 71, 161, 0.9)', 'rgba(100, 181, 246, 0.9)'],
                        borderRadius: 8,
                        barThickness: 35
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { beginAtZero: true },
                        y: { grid: { display: false } }
                    }
                }
            });
        }

        // Modal functions
        async function showDepartmentSummary(unit) {
            currentDepartment = unit;
            document.getElementById('summaryModalTitle').textContent = unit;
            document.getElementById('summaryModalSubtitle').textContent = '‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó';
            document.getElementById('summaryModal').style.display = 'block';

            try {
                const response = await fetch(`/api/equipment?unit=${encodeURIComponent(unit)}&limit=1000`);
                const result = await response.json();
                if (result.success) {
                    currentDepartmentEquipment = result.data;
                    displayDeptSummary(result.data);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function displayDeptSummary(equipment) {
            const content = document.getElementById('summaryContent');
            
            const typeMap = {};
            let totalAvailable = 0, totalDamaged = 0, totalPending = 0;

            equipment.forEach(v => {
                const type = v.category || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!typeMap[type]) typeMap[type] = { total: 0, available: 0, damaged: 0, pending: 0 };
                typeMap[type].total++;
                if (v.status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || !v.status) { typeMap[type].available++; totalAvailable++; }
                if (v.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î') { typeMap[type].damaged++; totalDamaged++; }
                if (v.status === '‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢') { typeMap[type].pending++; totalPending++; }
            });

            let html = '<div class="summary-grid">';
            Object.keys(typeMap).sort((a, b) => typeMap[b].total - typeMap[a].total).forEach(type => {
                const data = typeMap[type];
                html += `
                    <div class="summary-card">
                        <div class="summary-card-icon">${getTypeIcon(type)}</div>
                        <div class="summary-card-label">${type}</div>
                        <div class="summary-card-count">${data.total}</div>
                        <div class="summary-card-status">
                            <span>‚úì ${data.available}</span>
                            <span>‚úó ${data.damaged}</span>
                            <span>‚è≥ ${data.pending}</span>
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            html += `
                <div class="status-summary">
                    <h3 class="status-summary-title">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="status-cards-grid">
                        <div class="status-summary-card available" onclick="showDetailTable('‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ')">
                            <div class="status-summary-card-icon">‚úì</div>
                            <div class="status-summary-card-count">${totalAvailable}</div>
                            <div class="status-summary-card-label">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div>
                        </div>
                        <div class="status-summary-card damaged" onclick="showDetailTable('‡∏ä‡∏≥‡∏£‡∏∏‡∏î')">
                            <div class="status-summary-card-icon">‚úó</div>
                            <div class="status-summary-card-count">${totalDamaged}</div>
                            <div class="status-summary-card-label">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</div>
                        </div>
                        <div class="status-summary-card pending" onclick="showDetailTable('‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢')">
                            <div class="status-summary-card-icon">‚è≥</div>
                            <div class="status-summary-card-count">${totalPending}</div>
                            <div class="status-summary-card-label">‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</div>
                        </div>
                    </div>
                    <div class="click-hint">üí° ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
                </div>
            `;

            content.innerHTML = html;
        }

        async function showCategoryDetail(category) {
            document.getElementById('summaryModalTitle').textContent = getTypeIcon(category) + ' ' + category;
            document.getElementById('summaryModalSubtitle').textContent = '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå';
            document.getElementById('summaryModal').style.display = 'block';

            try {
                const response = await fetch(`/api/equipment?category=${encodeURIComponent(category)}&limit=1000`);
                const result = await response.json();
                if (result.success) {
                    currentDepartment = category;
                    currentDepartmentEquipment = result.data;
                    displayCategorySummary(result.data);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function displayCategorySummary(equipment) {
            const content = document.getElementById('summaryContent');
            
            const deptMap = {};
            let totalAvailable = 0, totalDamaged = 0, totalPending = 0;

            equipment.forEach(v => {
                const dept = v.unit || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                if (!deptMap[dept]) deptMap[dept] = { total: 0, available: 0, damaged: 0, pending: 0 };
                deptMap[dept].total++;
                if (v.status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || !v.status) { deptMap[dept].available++; totalAvailable++; }
                if (v.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î') { deptMap[dept].damaged++; totalDamaged++; }
                if (v.status === '‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢') { deptMap[dept].pending++; totalPending++; }
            });

            let html = '<div class="summary-grid">';
            Object.keys(deptMap).sort((a, b) => deptMap[b].total - deptMap[a].total).forEach(dept => {
                const data = deptMap[dept];
                html += `
                    <div class="summary-card">
                        <div class="summary-card-icon">üèõÔ∏è</div>
                        <div class="summary-card-label">${dept}</div>
                        <div class="summary-card-count">${data.total}</div>
                        <div class="summary-card-status">
                            <span>‚úì ${data.available}</span>
                            <span>‚úó ${data.damaged}</span>
                            <span>‚è≥ ${data.pending}</span>
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            html += `
                <div class="status-summary">
                    <h3 class="status-summary-title">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="status-cards-grid">
                        <div class="status-summary-card available" onclick="showDetailTable('‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ')">
                            <div class="status-summary-card-icon">‚úì</div>
                            <div class="status-summary-card-count">${totalAvailable}</div>
                            <div class="status-summary-card-label">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div>
                        </div>
                        <div class="status-summary-card damaged" onclick="showDetailTable('‡∏ä‡∏≥‡∏£‡∏∏‡∏î')">
                            <div class="status-summary-card-icon">‚úó</div>
                            <div class="status-summary-card-count">${totalDamaged}</div>
                            <div class="status-summary-card-label">‡∏ä‡∏≥‡∏£‡∏∏‡∏î</div>
                        </div>
                        <div class="status-summary-card pending" onclick="showDetailTable('‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢')">
                            <div class="status-summary-card-icon">‚è≥</div>
                            <div class="status-summary-card-count">${totalPending}</div>
                            <div class="status-summary-card-label">‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</div>
                        </div>
                    </div>
                    <div class="click-hint">üí° ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
                </div>
            `;

            content.innerHTML = html;
        }

        function showDetailTable(status) {
            let filtered = currentDepartmentEquipment;
            if (status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ') filtered = currentDepartmentEquipment.filter(v => v.status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || !v.status);
            else if (status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î') filtered = currentDepartmentEquipment.filter(v => v.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î');
            else if (status === '‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢') filtered = currentDepartmentEquipment.filter(v => v.status === '‡∏£‡∏≠‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢');

            document.getElementById('detailModalTitle').textContent = `${currentDepartment} - ${status}`;
            document.getElementById('detailModalSubtitle').textContent = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${filtered.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            document.getElementById('summaryModal').style.display = 'none';
            document.getElementById('detailModal').style.display = 'block';

            const content = document.getElementById('detailContent');
            content.innerHTML = `
                <table class="equipment-table">
                    <thead>
                        <tr>
                            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
                            <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
                            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map((v, i) => `
                            <tr>
                                <td>${i + 1}</td>
                                <td>${getTypeIcon(v.category)} ${v.category || '-'}</td>
                                <td>${v.item_name || '-'}</td>
                                <td>${v.equipment_code || '-'}</td>
                                <td>${v.unit || '-'}</td>
                                <td>${v.acquired_year || '-'}</td>
                                <td><span class="badge badge-${v.status === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || !v.status ? 'available' : v.status === '‡∏ä‡∏≥‡∏£‡∏∏‡∏î' ? 'damaged' : 'pending'}">${v.status || '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ'}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function closeSummaryModal() { document.getElementById('summaryModal').style.display = 'none'; }
        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
            document.getElementById('summaryModal').style.display = 'block';
        }

        window.onclick = function(event) {
            if (event.target === document.getElementById('summaryModal')) closeSummaryModal();
            if (event.target === document.getElementById('detailModal')) closeDetailModal();
        }
    </script>
</body>
</html>
